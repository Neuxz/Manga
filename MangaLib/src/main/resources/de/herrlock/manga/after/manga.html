<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<link rel="shortcut icon" href="favicon.ico">
<title>Manga</title>
	<style type="text/css">
		body	{ background-color: #000; 
					margin: 0px 20px 20px 10px; 
					padding: 20px 0px 0px 10px; }
		h1	{ color: #f00; 
				font-weight: normal; 
				text-decoration: underline; }
		h2	{ color: #f00; 
				font-weight: normal; }
		pre	{ font-family: 'Times New Roman', Times, Sans-Serif; }
		img	{ min-width: 600px; }
		img.fullwidth	{ width: 90%; }
		img.normalwidth	{ width: 660px; }
		hr	{ color: #f00; 
				background-color: #f00; 
				height: 5px; 
				border: none; }
		a	{ text-decoration: none; }
		a.whitelink:link	{ color: white; }
		a.whitelink:visited	{ color: white; }
		a.whitelink:hover	{ color: black;
								background-color: white; }
		a.hidelink:link	{ color: grey; }
		a.hidelink:visited	{ color: grey; }
		a.hidelink:hover	{ color: white; 
								background-color: black; 
								border: 1px red solid; }
		#bandindex	{ text-align: right; }
		#bandindex a	{ color: white; }
		#leftdiv	{ float: left; }
		#rightdiv	{ margin-left: 70px; }
	</style>
	<script type="text/JavaScript" src="jquery-2.1.0.min.js"></script>
	<script type="text/JavaScript">
		document.onkeydown = function(e)
		{
			switch (e.keyCode)
			{
				case 37: 
						choose(active - 1);
						break;
				case 39: 
						choose(active + 1);
						break;
			}
		};
	</script>
	<script type="text/JavaScript">
		/** the number of the newest chapter */
		var chapter = 	744;
		/** the maximal amount of pages that a chapter may have */
		var max_pages = 60;
		/** the amount of chapters per block on the left sidebar */
		var step = 10;
		/** the amount of blocks on the left sidebar */
		var chapterblock = ( chapter - (chapter % step) ) / step;
		/** the current active chapter */
		var active;
		
		/**
		 * loads the page with the latest chapter
		 */
		function init()
		{
			// das aktuelle kapitel anzeigen
			var post = parseInt(location.hash.substring(1));
			if(post === NaN)
				choose( chapter );
			else
				choose( post );
			// den passenden sidebarblock öffnen
			show(chapterblock);
		}
		/**
		 * shows pages from chapter x
		 */
		function choose(x)
		{
            active = x = parseInt(x);
            // nach oben scollen
            $('html,body').animate({ scrollTop: $('body').offset().top }, 2000);
			// bilder ausblenden
            $('#rightdiv').fadeOut(100);
            // hashangabe verändern
			location.hash = x;
			// title ändern
			$('title').html('Kapitel ' + x);
			// seitenüberschrift ändern (z.B. "Kapitel 623:"
			$('#pagetitle').html('Kapitel ' + x + ':');
			for (i = 1; i <= max_pages; i++)
			{
				// pfad zur standardisierten bilddatei
				var url = x + '\/' + (i < 10 ? "0"+i : i) + '.jpg';
				// bild auf existenz prüfen
				testImage(url, i);
				// bildpfad und alternative bildbeschreibung setzen
				$('#page' + i).attr({'src': url, 'alt': '\'' + url + '\''});
			}
            // bilder wieder einblenden
            $('#rightdiv').fadeIn(1900);
			// der link, der zum nächsten kapitel führt
			var el = $('#endlink');
			if(x >= chapter)
			{
				// es wird auf ein kapitel gewechselt, das noch keinen nachfolger hat
				el.css({'textDecoration': 'none', 'color': 'black'});
				el.html(whitelinkString('Kapitel ', (x + 1), ''));
			}
			else
			{
				// der link auf das nächst kapitel wird geändert
				el.css({'textDecoration': 'underline', 'color': 'red'});
				el.html(whitelinkString('Kapitel ', (x + 1), ''));
			}
			// nach einer sekunde (1000 ms) werden die bildgrößen überprüft und ggf. angepasst
			window.setTimeout('adjustIMGWidth()', 1000);
		}
		/**
		 * show block number x in the left menu, hide all the others
		 */
		function show(x)
		{
			
			for(i = chapterblock - 1; i >= 0; i--)
			{
				$('#block' + i).slideUp();
				$('#arrow' + i).html('&#x25ba;');
			}
			$('#block' + x).slideDown();
			$('#arrow' + x).html('&#x25bc;');
		}
		/**
		 * sets the width of all wide imgs to 100%
		 */
		function adjustIMGWidth()
		{
			for( i = 0; i < $('img').length; i++ )
			{
				var newClass = 
					$('#page' + i).prop('width') >= $('#page' + i).prop('height') ? 
					'fullwidth' : 'normalwidth';
				$('#page' + i).attr('class', newClass);
			}
		}
		/**
		 * returns the string for the "whitelink"-classed link to avoid redundancy
		 */
		function whitelinkString(pretext, chp, posttext)
		{
			return '<a class="whitelink" ' + 
						'id="choose' + chp + '" ' + 
						'href="javascript:void(0)"' +
						'onclick="choose(' + chp + ')" ' + 
						'title="Lade Kapitel ' + chp + '">' + 
						pretext + chp + posttext + '<\/a>';
		}
		/**
		 * returns the string for the "hidelink"-classed link to avoid redundancy
		 */
		function hidelinkString(blockId)
		{
			var blockName = (step * (blockId + 1));
			return '<a class="hidelink" ' + 
						'id="hidelink' + blockId + '" ' + 
						'href="javascript:void(0)"' +
						'onclick="show(' + blockId + ')" ' + 
						'title="Zeige Kapitel ' + (blockName - step + 1) + ' bis ' + blockName + '">' + 
					'<span id="arrow' + blockId + '"> hereComesAnArrow! <\/span> ' + blockName + '<\/a>';
		}
		/**
		 * versteckt die bildblöcke ('id = "IMGBlock ' + i + '"'), deren bilder nicht vorhanden sind.
		 * muss für jedes bild einzeln aufgerufen werden!
		 * @param url die url des zu testenden bildes
		 * @param i die id-nummer des bildblocks
		 */
		function testImage(url, i)
		{
			var img = new Image();
			img.src = url;
			
			// bild existiert nicht oder wurde falsch geladen
			img.onerror = img.onabort = function() 
			{
				$('#IMGBlock' + i).hide(100);
			};
			// bild existiert
			img.onload = function() 
			{
				$('#IMGBlock' + i).show(500);
			};
		}
	</script>
</head>
<body onload="init()">
	<div id="leftdiv">
		<script type="text/JavaScript">
		<!--
			// builds the left bar
			
			document.write('<pre>');
			document.write('<span style="display: none;" id="arrow' + chapterblock + '"> hereComesAnArrow! <\/span>');
			document.write('<div id="block' + chapterblock + '">');
			for(i = chapter % step; i > 0; i--)
			{
				tmpChp = chapter - (chapter % step) + i;
				document.writeln(whitelinkString('', tmpChp, ''));
			}
			document.write('<\/div>');
			for(i = chapterblock - 1; i >= 0; i--)
			{
				document.writeln(hidelinkString(i));
				document.write('<div id="block' + i + '">');
				for(j = step; j > 0; j--)
				{
					tmpChp = (step * i) + j;
					document.writeln(whitelinkString('', tmpChp, ''));
				}
				document.write('<\/div>');
			}
			document.write('<\/pre>');
		//-->
		</script>
	</div>
	<div id="rightdiv">
		<script type="text/JavaScript">
		<!--
			// builds the raw version of the page's main part
			
			document.write('<div id="bandindex"> <a href="bandindex.txt"> bandindex <\/a> <\/div>');
			document.write('<h1 id="pagetitle">If you can read this something BAD happened...<\/h1>');
			for(i = 1; i <= max_pages; i++)
			{
				document.write('<div id="IMGBlock' + i + '" class="IMGBlock">')
				document.write('<h2> ' + (i < 10 ? "0"+i : i) + ' <\/h2>');
				document.write('<div align="center"> <img id="page' + i + '" class="image" src="null.jpg" alt="null' + i + '.jpg" \/> <\/div>');
				document.write('<hr\/><\/div>');
			}
			document.write('<h1 id="endlink">Link to the next chapter<\/h1>');
		//-->
		</script>
		<br/><br/><br/><br/>
	</div>
</body>
</html>

